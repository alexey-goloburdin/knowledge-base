Здоров, котаны, пару лет уж я наблюдаю, как российские бигтехи постепенно хрюкнулись и стали ограничивать возможные символы в паролях.

![[sber.jpg|600]]

Иии, если раньше я думал, что это какие-то отдельные частные случаи, то сейчас мне уже так не кажется. Это такая феерия идиотизма с одной стороны и такой показатель беспросветного непрофессионализма с другой, что это важно зафиксировать.

О чём речь. Речь о том, что вход в большинство сервисов осуществляется по паролю и чаще всего пароль мы задаём сами. И сервис иногда имеет *требования* к этому паролю. Например, большинство сервисов не пропустит слишком короткий пароль, состоящий из, например, трёх символов, потому что такой пароль можно будет быстро подобрать простым перебором. Пароль из трех символов — это попросту небезопасно, и ограничение минимальной длины пароля объективно разумно.

Сервисы же обычно заставляют нас ставить безопасные пароли — длинные, состоящая из букв, цифр и спецсимволов.  Чем длиннее пароль и чем большее количество символов используется для его составления, тем большее количество вариантов таких паролей существует, и тем сложнее, соответственно, такой пароль подобрать.

Но что же мы видим? Мы видим, что Сбербанк, например, позволяет использовать только разрешённые символы. Например, символ процента и амперсанда использовать в пароле можно, а вот символ кавычки — нельзя. Почему? А вот потому! Вот в Сбербанке изобрели собственную криптографию, в соответствии с которой чтобы пароль был более безопасным, надо... чтобы он был менее безопасным. Вот такая вот криптография! Специальная такая! Инновационная нанотехнологичная криптография!

Аналогично поступает Яндекс для бизнеса — при добавлении сотрудника в Яндекс 360 нельзя вот так взять и использовать произвольный спецсимвол. Альфабанк тоже занимается изобретением собственной криптографии. Туда же Рамблер, cloud.ru. Да что там говорить, люди в себя поверили уже даже в госушных сервисах и такие кренделя выписывают, шо мама не горюй! Личный кабинет индивидуального предпринимателя, пожалуйста, символ решётки использовать можно, а вопросительный знак — нельзя. Ну а чё там вопрошать в пароле? Правильно? Правильно. Незачем.

Даже госуслули не позволяют ввести любой спецсимвол и ограничивают набор спецсимволов, которые можно использовать в пароле.

Причём вот в личном кабинете ИП, скажем, звёздочку использовать в пароле можно, а в госуслугах нельзя. А кавычки в госуслугах можно, а больше нигде — нельзя! А вот скобки в альфа-банке нельзя, а в сбербанке и яндексе можно. Мамкины криптографы пока не договорились, что можно, а что нельзя, что безопасно, а что нет. Тут, вероятно, просто дело такое, что во всех этих организациях изобретается своя православная криптография, и они, эти криптографии, не всегда пересекаются.

Ну, ладненько. Почему это бред?

Ну, во-первых, есть такая штука как комбинаторика. Проходят её в 9м классе школы. То есть, если люди ушли после девятого класса в техникум, а оттуда сразу пошли работать в Сбербанк и Яндекс и Госуслуги, то в целом про комбинаторику они всё равно знать должны.

Так вот в комбинаторике есть такая штука как размещения с повторениями. Она позволяет считать количество вариантов паролей длины `LENGTH`, составленного из символов количеством `SYMBOLS`. Количество вариантов паролей составляет `SYMBOLS ^ LENGTH`.

Вот, например, сколько разных паролей длиной 3 символа может быть составлено из английского алфавита? Как мы знаем, в английском алфавите 26 символов. Поэтому количество версий пароля составляет ( 26^3 ), 17576 паролей. Это не очень много, можно подобрать такой пароль.

А если добавить ещё возможность использовать большие символы алфавита? Будет уже 52 символа в степени 3, 140608. Это в 8 раз больше, чем пароли из только маленьких символов.

Если добавить сюда  цифры, получится 62 в третьей степени, то есть 238328.

Если добавить сюда 33 спецсимвола, которые можно легко набрать на клавиатуре, то получится уже 95 в третьей степени, 857375. Это в 48 раз больше, чем просто маленькие символы английского алфавита.

То есть мы понимаем, что чем больше разных символов мы можем использовать в пароле, тем большее количество паролей одной и той же длины мы можем создать. Тем безопаснее соответственно будет пароль, тем дольше, например, его надо будет подбирать.

Давайте зафиксируем эту простую мысль, доступную девятикласснику. Если в пароле можно использовать все 33 спецсимвола, он будет надёжнее, безопаснее, чем если в пароле можно использовать только 12 спецсимволов, как в большинстве обсуждаемых сервисов. Это комбинаторика, она так работает, есть формула, можно построить график. Это суровый математический аппарат, повторюсь, девятого класса. Надёжность пароля *снижается* при сокращении количества возможных к использованию в пароле символов. Запрет на использовании в пароле восклицательного знака *снижает* его надёжность.

Яндекс, Сбер, Альфабанк, Рамблер, госуслуги и тд — *снижают* безопасность паролей, не позволяя использовать любые символы.

Мы сейчас даже не говорим об использовании произвольных UTF8 символов, например, кириллицы или emoji. Это уж ладно, это уж куда нам.

Это первая мысль. Запрет на использование в пароле какого-то спецсимвола — снижает его безопасность.

Вторая мысль. Давайте порассуждаем, откуда тут могут расти ноги, что в пароле нельзя использовать какой-то символ.

Одни скажут — ну так это жо защита от SQL-инъекции! Ну ты шо, Алексей, ну такие-то уж вещи знать надо, НУ ШО ТЫ ВОТ НАМ РАССКАЗЫВАЕШЬ, ВЫЛЕЗ, КОВЫЧКИ ЕМУ В ПОРОЛЕ ПОДОВАЙ!

И если такое говорит бэкенд-разработчик, то братан, извини, тебя допускать до бэкенд-разработки-то не надо, это нахрен чревато! О чём речь. Речь о том, что вот мы используем PostgreSQL и например Python — это всё актуально и для других языков и СУБД, просто для примера ([github](https://github.com/alexey-goloburdin/innovative-bigtech-cryptography-demo/tree/password_as_plain_text_and_sql_injection)):

```python
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
from dotenv import load_dotenv
import os
import psycopg


load_dotenv()

app = FastAPI()

DATABASE_URL = os.getenv("DATABASE_URL")
USER_ID = 1


class ChangePasswordRequest(BaseModel):
    password: str


class CheckPasswordRequest(BaseModel):
    password: str


class CheckPasswordResponse(BaseModel):
    valid: bool


def get_connection() -> psycopg.Connection:
    if not DATABASE_URL:
        raise RuntimeError(
            "DATABASE_URL is not set. "
            "Please define it in your .env file."
        )
    return psycopg.connect(DATABASE_URL)


@app.post("/password", status_code=204)
def change_password(payload: ChangePasswordRequest) -> None:
    """
    Change password for the user with id=1.
    """
    with get_connection() as connection:
        with connection.cursor() as cursor:
            cursor.execute(
                f"UPDATE users "
                f"SET password = '{payload.password}' WHERE id = {USER_ID}"
            )

            if cursor.rowcount == 0:
                raise HTTPException(
                    status_code=404,
                    detail="User not found.",
                )


@app.post("/password/check", response_model=CheckPasswordResponse)
def check_password(payload: CheckPasswordRequest) -> CheckPasswordResponse:
    """
    Check given password for the user with id=1.
    """
    with get_connection() as conn:
        with conn.cursor() as cur:
            cur.execute(
                f"SELECT password FROM users WHERE id = {USER_ID}"
            )
            row = cur.fetchone()

    if row is None:
        # If there is no user with id=1, treat as invalid.
        return CheckPasswordResponse(valid=False)

    stored_password = row[0]
    is_valid = stored_password == payload.password

    return CheckPasswordResponse(valid=is_valid)
```









радужные таблицы


Я думаю, РКН для порядку надо запретить использовать в паролях всё, что не наши, православные, подчёркивающие традиционные ценности цифры 1234!